{
  "hash": "65581d92af88128032d2381dbdf2f225",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Analysis of Frequencies\"\nsubtitle: Lecture 10\nformat:\n  revealjs:\n    theme: clean.scss\n    scrollable: true\n    footer: \"Lecture 10 - [Back to home](https://madfudolig.quarto.pub/introtobiostats/)\"\n    code-block-bg: true\n    code-block-border-left: \"#31BAE9\"\n    slide-number: true\n    menu: true\n    code-annotations: hover\n    chalkboard: true\n    engine: knitr\n    echo: true\n    code-fold: false\n    \n  pdf: \n    number-sections: true\n    engine: knitr\nbibliography: references.bib\n---\n\n# Outline\n\n-   Introduction to Categorical Data\n-   Goodness-of-Fit Tests\n-   Test of Homogeneity\n-   Test of Independence\n-   Fisher's Exact Test\n-   McNemar's Test\n\n# Categorical Data\n\n## Associations between Categorical Data\n\nOften, we are interested in testing for association between categorical data. These variables can be nominal or ordinal.\n\n::: callout-note\nSuppose we want to test whether there is an association between the type of hospital a patient is admitted to and their diagnosed conditions.\n:::\n\n## Contingency Tables\n\nA contingency table is a table of frequencies or counts for each possible combination of the variables.\n\n::: callout-note\n## Example\n\nThe hair and eye color of male statistics students were measured. The findings were summarized in the following contingency table.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n       Eye\nHair    Brown Blue Hazel Green\n  Black    32   11    10     3\n  Brown    53   50    25    15\n  Red      10   10     7     7\n  Blond     3   30     5     8\n```\n\n\n:::\n:::\n\n:::\n\n## Contingency tables in `R`\n\nYou can use `xtabs()` to produce contingency tables in `R`. The data should be formatted such that the two variables are defined by two columns. If these columns are `x` and `y` from a data frame `df`, the sample code would look like:\n\n``` r\nxtabs(~x+y,data=df)\n```\n\n`x` will be assigned as the row variable, `y` will be assigned as the column variable.\n\n## Example\n\nThe data set `penguins` preloaded in `R` includes data from penguins at the Palmer Archipelago in Antarctica.\n\n::: panel-tabset\n### Question\n\nCreate a contingency table for this data that summarizes the number of penguins belonging to each species and sex.\n\n### Answer\n\n\n::: {.cell}\n\n```{.r .cell-code}\nxtabs(~species+sex,data=penguins)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n           sex\nspecies     female male\n  Adelie        73   73\n  Chinstrap     34   34\n  Gentoo        58   61\n```\n\n\n:::\n:::\n\n:::\n\n## Chi-Squared Distribution\n\nTests involving categorical data use the chi-squared distribution to approximate the distribution of the test statistics.\n\n::: panel-tabset\n### Support\n\nThe chi-squared distribution is defined for non-negative values $(0,\\infty)$.\n\n### Parameter\n\nThe chi-squared distribution can be defined by the degrees of freedom $\\nu$ or $df$.\n\nLike the t-distribution, we only need one value for the degree of freedom.\n\n### Relation to Gaussian Distribution\n\nSuppose $Z$ follows the standard Gaussian distribution N(0,1). Then $Z^2$ follows a chi-square distribution with 1 degree of freedom.\n\n### Mean and Variance\n\nThe mean of the chi-squared distribution is $k$, and the variance of the chi-squared distribution is $2k$.\n:::\n\n# Goodness-of-Fit Tests\n\n## Goodness of Fit\n\nSuppose we want to test if the data follows a specified distribution.\n\n::: callout-note\n## Example\n\nSuppose we want to know if a six-sided die is fair. We would expect to roll the numbers uniformly after a large number of throws. However, there will be variability due to randomness. The goodness-of-fit test will provide information if we have evidence of deviating from the pre-specified uniform distribution.\n:::\n\n## Hypothesis Test\n\nThe null hypothesis of the goodness-of-fit test is that **the observed data follows the specified distribution**, while the alternative is that it does not follow the specified distribution.\n\n## Test Statistic\n\nSuppose there are $k$ bins separating the data and that the distribution provides an expected number/counts of events $E_i$ for $i=1,2,...k$. If the observed number/counts in the data is $O_i$, we define the test statistics $Q$ such that\n\n$$\nQ = \\sum_{i=1}^k \\frac{(O_i - E_i)^2}{E_i}\n$$\n\n::: callout-important\nQ approximately follows the chi-squared distribution with $k-1$ degrees of freedom, denoted by $\\chi^2_{k-1}$.\n\nFor the chi-squared distribution assumption to be valid, the expected value of each bin should be greater than 5.\n:::\n\n## p-value calculation\n\nThe p-values can be calculated using the chi-squared distribution such that:\n\n$$\np-value = P(\\chi^2_{k-1} \\geq Q)\n$$\n\n## `R` implementation\n\nThere are two ways to check for goodness of fit: formal statistical analysis and exploratory data visualization.\n\n:::: panel-tabset\n### Expected Values\n\nFor discrete distributions, the expected values can be calculated using the PDF functions ( `dpois`, `dbinom`) for discrete distributions, and CDF functions (`pnorm`,`punif`, `pt`).\n\n### Formal Statistical Analysis\n\nThe `chisq.test` function performs the chi-squared test of goodness of fit. The function needs a vector of the observed variables, `x_observed` and a vector of probabilities `p`.\n\n``` r\nchisq.test(x=x_observed, p=p)\n```\n\n::: callout-important\nThe `chisq.test()` function includes a continuity correction in calculating the test statistic and the corresponding p-value. If we want the uncorrected statistic and p-value, we need to specify `correct=FALSE`.\n:::\n\n### Visualization\n\nOnce the expected values are calculated, we can plot these values using `ggplot()`. \n::::\n\n## Example\n\nElectronic integrated circuits are produced from thin wafers that are cut from some material. The wafers produced sometimes have tiny flaws on them that make part of the wafer unusable. Suppose we produce 1000 wafers and for each we determine the number of flaws.\n\n::: panel-tabset\n### Data\n\n| Number of Flaws | Observed Frequency |\n|-----------------|--------------------|\n| 0               | 10                 |\n| 1               | 220                |\n| 2               | 130                |\n| 3               | 80                 |\n| 4               | 60                 |\n| 5 or more       | 90                 |\n\n### Question\n\nTest whether these data follow a Poisson distribution with $\\lambda=1.44$. Visualize the observed and expected counts to support the results of the test.\n\n### Answer\n\nWe specify the observed variable.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nobserved <- c(10,220,130,80,60,90)\nobserved\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1]  10 220 130  80  60  90\n```\n\n\n:::\n\n```{.r .cell-code}\ntotal <- sum(observed)\ntotal\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 590\n```\n\n\n:::\n:::\n\n\nThe specified distribution is the Poisson distribution. We can then calculate the expected probabilities using `dpois` and `ppois`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nexpected <- c(\ndpois(0,lambda=1.44),\ndpois(1,lambda=1.44),\ndpois(2,lambda=1.44),\ndpois(3,lambda=1.44),\ndpois(4,lambda=1.44),\n1-ppois(4,lambda=1.44)\n)\nexpected\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.23692776 0.34117597 0.24564670 0.11791042 0.04244775 0.01589140\n```\n\n\n:::\n\n```{.r .cell-code}\nsum(expected) # must be 1\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1\n```\n\n\n:::\n\n```{.r .cell-code}\ntotal*expected # there should not be more than 1.5 bins that have less than 5 expected counts\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 139.787378 201.293824 144.931553  69.567145  25.044172   9.375928\n```\n\n\n:::\n:::\n\n\nAll expected counts are above 5. We can now use the chi-square approximation for the p-value.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nchisqtest <- chisq.test(x=observed,p=expected)\nchisqtest\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tChi-squared test for given probabilities\n\ndata:  observed\nX-squared = 867.42, df = 5, p-value < 2.2e-16\n```\n\n\n:::\n:::\n\n\nThe test statistic is 867.4246622 with a p-value \\< 2.2e-16. We reject the null hypothesis. We have sufficient evidence to conclude that the observed data does not follow the Poisson distribution.\n\n### Plot\n\nThe function `bind_rows` appends the expected data frame to the observed data frame.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n-- Attaching core tidyverse packages ------------------------ tidyverse 2.0.0 --\nv dplyr     1.1.4     v readr     2.1.5\nv forcats   1.0.0     v stringr   1.5.2\nv ggplot2   4.0.0     v tibble    3.3.0\nv lubridate 1.9.4     v tidyr     1.3.1\nv purrr     1.1.0     \n-- Conflicts ------------------------------------------ tidyverse_conflicts() --\nx dplyr::filter() masks stats::filter()\nx dplyr::lag()    masks stats::lag()\ni Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code}\ndf_observed <- data.frame(bin = c(0,1,2,3,4,\"5 or more\"),y=observed,type=\"Observed\")\ndf_expected <- data.frame(bin = c(0,1,2,3,4,\"5 or more\"),y=total*expected,type=\"Expected\")\ndf <- bind_rows(df_observed,df_expected)\n\nggplot(df,aes(x=bin,y=y,group=type,fill=type)) +\n  geom_bar(position=\"dodge\",stat=\"identity\") + \n  theme_bw() + \n  labs(x=\"Number of failures\", y=\"Count\",fill=\"Observed vs. Expected\")\n```\n\n::: {.cell-output-display}\n![](lecture10_files/figure-pdf/unnamed-chunk-6-1.pdf){fig-pos='H'}\n:::\n:::\n\n:::\n\n## Exercise\n\nIn the “nighttime” lottery run by the state of Texas, three numbers are selected from the digits 0 through 9. The frequencies of the first digit selected over a period of almost 30 years (from 1993 to 2023) are shown below for each of the 9,215 days.\n\n::: panel-tabset\n### Data Set\n\n| Digit | Frequency |\n|-------|-----------|\n| 0     | 918       |\n| 1     | 905       |\n| 2     | 908       |\n| 3     | 916       |\n| 4     | 900       |\n| 5     | 911       |\n| 6     | 963       |\n| 7     | 948       |\n| 8     | 937       |\n| 9     | 909       |\n\n### Question\n\nTest whether each digit is equally likely to have been selected in the Texas \"nighttime\" lottery.\n\n### Answer\n\n\nWe specify the observed variable.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nobserved <- c(918,905,908,916,900,911,963,948,937,909)\nobserved\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] 918 905 908 916 900 911 963 948 937 909\n```\n\n\n:::\n\n```{.r .cell-code}\ntotal <- sum(observed)\ntotal\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 9215\n```\n\n\n:::\n:::\n\n\nThe specified distribution is the discrete uniform distribution. We can then calculate the uniform probabilities as 1/10 (10 bins).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nexpected <- c(1/10,1/10,1/10,1/10,1/10,1/10,1/10,1/10,1/10,1/10\n)\nexpected\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1\n```\n\n\n:::\n\n```{.r .cell-code}\nsum(expected) # must be 1\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1\n```\n\n\n:::\n\n```{.r .cell-code}\ntotal*expected # there should not be more than 1.5 bins that have less than 5 expected counts\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] 921.5 921.5 921.5 921.5 921.5 921.5 921.5 921.5 921.5 921.5\n```\n\n\n:::\n:::\n\n\nAll expected counts are above 5. We can now use the chi-square approximation for the p-value.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nchisqtest <- chisq.test(x=observed,p=expected)\nchisqtest\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tChi-squared test for given probabilities\n\ndata:  observed\nX-squared = 4.2219, df = 9, p-value = 0.8962\n```\n\n\n:::\n:::\n\n\nThe test statistic is 4.2219208 with a p-value 0.8962084. We fail to reject the null hypothesis. We have insufficient evidence to conclude that the digits are not equally likely to be chosen for the \"nighttime\" lottery.\n\n### Plot\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\ndf_observed <- data.frame(bin = 0:9,y=observed,type=\"Observed\")\ndf_expected <- data.frame(bin = 0:9,y=total*expected,type=\"Expected\")\ndf <- bind_rows(df_observed,df_expected)\n\nggplot(df,aes(x=as.factor(bin),y=y,group=type,fill=type)) +\n  geom_bar(position=\"dodge\",stat=\"identity\") + \n  theme_bw() + \n  labs(x=\"Number of failures\", y=\"Count\",fill=\"Observed vs. Expected\")\n```\n\n::: {.cell-output-display}\n![](lecture10_files/figure-pdf/unnamed-chunk-10-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n:::\n",
    "supporting": [
      "lecture10_files\\figure-pdf"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}